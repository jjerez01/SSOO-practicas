<!DOCTYPE html>
<html>
<head>
<title>p2e2.md</title>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8">

<style>
/* https://github.com/microsoft/vscode/blob/master/extensions/markdown-language-features/media/markdown.css */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

body {
	font-family: var(--vscode-markdown-font-family, -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif);
	font-size: var(--vscode-markdown-font-size, 14px);
	padding: 0 26px;
	line-height: var(--vscode-markdown-line-height, 22px);
	word-wrap: break-word;
}

#code-csp-warning {
	position: fixed;
	top: 0;
	right: 0;
	color: white;
	margin: 16px;
	text-align: center;
	font-size: 12px;
	font-family: sans-serif;
	background-color:#444444;
	cursor: pointer;
	padding: 6px;
	box-shadow: 1px 1px 1px rgba(0,0,0,.25);
}

#code-csp-warning:hover {
	text-decoration: none;
	background-color:#007acc;
	box-shadow: 2px 2px 2px rgba(0,0,0,.25);
}

body.scrollBeyondLastLine {
	margin-bottom: calc(100vh - 22px);
}

body.showEditorSelection .code-line {
	position: relative;
}

body.showEditorSelection .code-active-line:before,
body.showEditorSelection .code-line:hover:before {
	content: "";
	display: block;
	position: absolute;
	top: 0;
	left: -12px;
	height: 100%;
}

body.showEditorSelection li.code-active-line:before,
body.showEditorSelection li.code-line:hover:before {
	left: -30px;
}

.vscode-light.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(0, 0, 0, 0.15);
}

.vscode-light.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(0, 0, 0, 0.40);
}

.vscode-light.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-dark.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 255, 255, 0.4);
}

.vscode-dark.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 255, 255, 0.60);
}

.vscode-dark.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-high-contrast.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 160, 0, 0.7);
}

.vscode-high-contrast.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 160, 0, 1);
}

.vscode-high-contrast.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

img {
	max-width: 100%;
	max-height: 100%;
}

a {
	text-decoration: none;
}

a:hover {
	text-decoration: underline;
}

a:focus,
input:focus,
select:focus,
textarea:focus {
	outline: 1px solid -webkit-focus-ring-color;
	outline-offset: -1px;
}

hr {
	border: 0;
	height: 2px;
	border-bottom: 2px solid;
}

h1 {
	padding-bottom: 0.3em;
	line-height: 1.2;
	border-bottom-width: 1px;
	border-bottom-style: solid;
}

h1, h2, h3 {
	font-weight: normal;
}

table {
	border-collapse: collapse;
}

table > thead > tr > th {
	text-align: left;
	border-bottom: 1px solid;
}

table > thead > tr > th,
table > thead > tr > td,
table > tbody > tr > th,
table > tbody > tr > td {
	padding: 5px 10px;
}

table > tbody > tr + tr > td {
	border-top: 1px solid;
}

blockquote {
	margin: 0 7px 0 5px;
	padding: 0 16px 0 10px;
	border-left-width: 5px;
	border-left-style: solid;
}

code {
	font-family: Menlo, Monaco, Consolas, "Droid Sans Mono", "Courier New", monospace, "Droid Sans Fallback";
	font-size: 1em;
	line-height: 1.357em;
}

body.wordWrap pre {
	white-space: pre-wrap;
}

pre:not(.hljs),
pre.hljs code > div {
	padding: 16px;
	border-radius: 3px;
	overflow: auto;
}

pre code {
	color: var(--vscode-editor-foreground);
	tab-size: 4;
}

/** Theming */

.vscode-light pre {
	background-color: rgba(220, 220, 220, 0.4);
}

.vscode-dark pre {
	background-color: rgba(10, 10, 10, 0.4);
}

.vscode-high-contrast pre {
	background-color: rgb(0, 0, 0);
}

.vscode-high-contrast h1 {
	border-color: rgb(0, 0, 0);
}

.vscode-light table > thead > tr > th {
	border-color: rgba(0, 0, 0, 0.69);
}

.vscode-dark table > thead > tr > th {
	border-color: rgba(255, 255, 255, 0.69);
}

.vscode-light h1,
.vscode-light hr,
.vscode-light table > tbody > tr + tr > td {
	border-color: rgba(0, 0, 0, 0.18);
}

.vscode-dark h1,
.vscode-dark hr,
.vscode-dark table > tbody > tr + tr > td {
	border-color: rgba(255, 255, 255, 0.18);
}

</style>

<style>
/* Tomorrow Theme */
/* http://jmblog.github.com/color-themes-for-google-code-highlightjs */
/* Original theme - https://github.com/chriskempson/tomorrow-theme */

/* Tomorrow Comment */
.hljs-comment,
.hljs-quote {
	color: #8e908c;
}

/* Tomorrow Red */
.hljs-variable,
.hljs-template-variable,
.hljs-tag,
.hljs-name,
.hljs-selector-id,
.hljs-selector-class,
.hljs-regexp,
.hljs-deletion {
	color: #c82829;
}

/* Tomorrow Orange */
.hljs-number,
.hljs-built_in,
.hljs-builtin-name,
.hljs-literal,
.hljs-type,
.hljs-params,
.hljs-meta,
.hljs-link {
	color: #f5871f;
}

/* Tomorrow Yellow */
.hljs-attribute {
	color: #eab700;
}

/* Tomorrow Green */
.hljs-string,
.hljs-symbol,
.hljs-bullet,
.hljs-addition {
	color: #718c00;
}

/* Tomorrow Blue */
.hljs-title,
.hljs-section {
	color: #4271ae;
}

/* Tomorrow Purple */
.hljs-keyword,
.hljs-selector-tag {
	color: #8959a8;
}

.hljs {
	display: block;
	overflow-x: auto;
	color: #4d4d4c;
	padding: 0.5em;
}

.hljs-emphasis {
	font-style: italic;
}

.hljs-strong {
	font-weight: bold;
}
</style>

<style>
/*
 * Markdown PDF CSS
 */

 body {
	font-family: -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif, "Meiryo";
	padding: 0 12px;
}

pre {
	background-color: #f8f8f8;
	border: 1px solid #cccccc;
	border-radius: 3px;
	overflow-x: auto;
	white-space: pre-wrap;
	overflow-wrap: break-word;
}

pre:not(.hljs) {
	padding: 23px;
	line-height: 19px;
}

blockquote {
	background: rgba(127, 127, 127, 0.1);
	border-color: rgba(0, 122, 204, 0.5);
}

.emoji {
	height: 1.4em;
}

code {
	font-size: 14px;
	line-height: 19px;
}

/* for inline code */
:not(pre):not(.hljs) > code {
	color: #C9AE75; /* Change the old color so it seems less like an error */
	font-size: inherit;
}

/* Page Break : use <div class="page"/> to insert page break
-------------------------------------------------------- */
.page {
	page-break-after: always;
}

</style>

<script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
</head>
<body>
  <script>
    mermaid.initialize({
      startOnLoad: true,
      theme: document.body.classList.contains('vscode-dark') || document.body.classList.contains('vscode-high-contrast')
          ? 'dark'
          : 'default'
    });
  </script>
<h1 id="ejercicio-2-p2">Ejercicio 2 P2</h1>
<p>En esta practica te piden copiar un archivo(origen.txt), crear otro(destino.txt) y pegar el contenido del archivo origen en el destino</p>
<p>todo esto solo usando las llamadas open, close, read, write, lstat, readlink, symlink, lseek, opendir y readdir (cogiendo las que son necesarias)</p>
<h2 id="version-juan">Version Juan</h2>
<pre class="hljs"><code><div><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> *argv[])</span>
</span>{
	<span class="hljs-keyword">char</span>* fdo = argv[<span class="hljs-number">1</span>];
	<span class="hljs-keyword">char</span>* fdd = argv[<span class="hljs-number">2</span>];
	copy(fdo,fdd);
	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</div></code></pre>
<p>en el caso del main al pasar como argumento el archivo origen y luego el destino estos estaran guardados asi</p>
<ul>
<li>origen -&gt; argv[1]</li>
<li>destino -&gt; argv[2]</li>
</ul>
<p>y ponemos como variables siempre que sean char*</p>
<pre class="hljs"><code><div><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">copy</span><span class="hljs-params">(<span class="hljs-keyword">char</span>* fdo, <span class="hljs-keyword">char</span>* fdd)</span>
</span>{
	<span class="hljs-keyword">int</span> s;
	<span class="hljs-keyword">char</span> <span class="hljs-built_in">buffer</span>[<span class="hljs-number">512</span>];
	
	<span class="hljs-keyword">int</span> <span class="hljs-keyword">or</span> = <span class="hljs-built_in">open</span>(fdo,O_RDONLY,<span class="hljs-number">0664</span>);
	<span class="hljs-keyword">int</span> des = <span class="hljs-built_in">open</span>(fdd,O_WRONLY|O_CREAT|O_TRUNC,<span class="hljs-number">0664</span>);
}
</div></code></pre>
<p>para abrir los archivos tenemos que pasarle los char punteros a la funcion copy, crear el buffer donde se van a almacenar todas las letras que copiemos de una sentada y abrir los archivos con las flags de O_RDONLY y O_WRONLY respectivamente, O_CREAT para el archivo destino y O_TRUNC sirve para si hay algo escrito en el archivo destino que lo borre.</p>
<pre class="hljs"><code><div><span class="hljs-keyword">while</span>(s = <span class="hljs-built_in">read</span>(<span class="hljs-keyword">or</span>,<span class="hljs-built_in">buffer</span>,<span class="hljs-number">512</span>) == <span class="hljs-number">512</span>){
    <span class="hljs-built_in">write</span>(des,<span class="hljs-built_in">buffer</span>,<span class="hljs-number">512</span>);
}

<span class="hljs-built_in">close</span>(<span class="hljs-keyword">or</span>);
<span class="hljs-built_in">close</span>(des);
</div></code></pre>
<p>para entonces leer el archivo de origen y escribir en el destino cogemos del origen 512 caracteres y los metemos en el buffer de 512 bytes y en cuanto la variable s, que es el numero de bytes leidos, se llene ( == 512) escribimos en el destino</p>
<p>despues cerramos los archivos</p>
<p><strong>por poder se puede mejorar el ejercicio pq al final no copia todo entonces se puede ir byte por byte (en vez de 512 que sea 1) se mejora en la version del profesor</strong></p>
<h2 id="version-profesor">Version profesor</h2>
<pre class="hljs"><code><div><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;sys/types.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;sys/stat.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;fcntl.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;unistd.h&gt;</span></span>

<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> BUFSIZE		13</span>

<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> **argv)</span> </span>{
    <span class="hljs-keyword">int</span>  n_read;
    <span class="hljs-keyword">int</span>  ent, sal;
   	
    <span class="hljs-keyword">char</span> <span class="hljs-built_in">buffer</span>[BUFSIZE];
    
	<span class="hljs-keyword">if</span> (argc != <span class="hljs-number">3</span>) {
		<span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>,<span class="hljs-string">"Error. Uso: ./copia &lt;src&gt; &lt;dst&gt;\n"</span>);
		<span class="hljs-built_in">exit</span>(<span class="hljs-number">-1</span>);
	}

    ent = <span class="hljs-built_in">open</span>(argv[<span class="hljs-number">1</span>], O_RDONLY); <span class="hljs-comment">/* abre el archivo de entrada */</span>	
	<span class="hljs-keyword">if</span> (ent == <span class="hljs-number">-1</span>){
        perror(<span class="hljs-string">"Fallo open src:"</span>);
	   	<span class="hljs-built_in">exit</span>(<span class="hljs-number">-1</span>);
    }
    

    sal = <span class="hljs-built_in">open</span>(argv[<span class="hljs-number">2</span>], O_WRONLY | O_CREAT | O_TRUNC , <span class="hljs-number">0644</span>);     <span class="hljs-comment">/* crea el archivo de salida */</span>
    <span class="hljs-keyword">if</span> (sal == <span class="hljs-number">-1</span>){
        <span class="hljs-built_in">close</span>(ent);
        perror(<span class="hljs-string">"Fallo open dst:"</span>);    
		<span class="hljs-built_in">exit</span>(<span class="hljs-number">-1</span>);
    }	   

    <span class="hljs-comment">/* bucle de lectura del archivo de entrada */</span>
    <span class="hljs-keyword">while</span> ( (n_read = <span class="hljs-built_in">read</span>(ent,<span class="hljs-built_in">buffer</span>,  BUFSIZE) ) == BUFSIZE)  {    
        	<span class="hljs-comment">/* escribir el buffer al archivo de salida */</span>
        	<span class="hljs-keyword">if</span> (<span class="hljs-built_in">write</span>( sal,<span class="hljs-built_in">buffer</span>, BUFSIZE) &lt; BUFSIZE)  {
            		perror(<span class="hljs-string">"write"</span>);
            		<span class="hljs-built_in">close</span>(ent); 
					<span class="hljs-built_in">close</span>(sal);
            		<span class="hljs-built_in">exit</span>(<span class="hljs-number">-1</span>);
       	 	}
    }
	<span class="hljs-keyword">if</span> (n_read &gt; <span class="hljs-number">0</span>) 
		<span class="hljs-built_in">write</span>(sal,<span class="hljs-built_in">buffer</span>, n_read);
	
	<span class="hljs-built_in">close</span>(ent); 
	<span class="hljs-built_in">close</span>(sal);
    <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);
}

</div></code></pre>
<p>el error de antes se soluciona poniendo un &lt; en vez de un igual en el write pq asi lo copia lo escribe lo que queda y sale de la iteracion</p>

</body>
</html>
